<link rel="import" href="./bower_components/polymer/polymer.html">

<dom-module id="geomap-element">
  <style>
    google-map {
      height: 500px;
    }
  </style>
  <template>
    <geo-location watch-pos latitude="{{lat}}" longitude="{{lng}}"></geo-location>
    <google-map latitude="[[lat]]" longitude="[[lng]]">
      <google-map-marker latitude="[[lat]]" longitude="[[lng]]"></google-map-marker>
    </google-map>
    <iron-ajax
      auto
      headers='{"X-Requested-With": "XMLHttpRequest", "Accept":"application/json"'
      url="/callApi.php"
      method="POST"
      body='{"lat":"{{lat}}","lng":"{{lng}}"}'
      handle-as="json"
      on-response="handleResponse"
      last-response="{{ajaxResponse}}"
      debounce-duration="300"></iron-ajax>
  </template>
      
  <script>
  Polymer({
    is: "geomap-element",
    ready: function () {
      var loc = document.querySelector('geo-location');
      loc.addEventListener('geo-response', function(e) {
        console.log('lat:' + this.latitude, 'lng:' + this.longitude);
        this.lat=this.latitude;
        this.lng=this.lng;
      });
    }
  });
  </script>
</dom-module>